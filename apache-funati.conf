<VirtualHost *:80>
    ServerName localhost
    DocumentRoot /app/funATI
    
    # Load MIME types
    LoadModule mime_module modules/mod_mime.so
    
    # WebSocket proxy for Django Channels
    ProxyPreserveHost On
    
    # WebSocket connections (for chat)
    ProxyPass /ws/ ws://127.0.0.1:8001/ws/
    ProxyPassReverse /ws/ ws://127.0.0.1:8001/ws/
    
    # HTTP requests to Daphne (Django app)
    ProxyPass /admin/ http://127.0.0.1:8001/admin/
    ProxyPassReverse /admin/ http://127.0.0.1:8001/admin/
    
    ProxyPass /muro/ http://127.0.0.1:8001/muro/
    ProxyPassReverse /muro/ http://127.0.0.1:8001/muro/
    
    ProxyPass /login/ http://127.0.0.1:8001/login/
    ProxyPassReverse /login/ http://127.0.0.1:8001/login/
    
    ProxyPass /register/ http://127.0.0.1:8001/register/
    ProxyPassReverse /register/ http://127.0.0.1:8001/register/
    
    ProxyPass /chats/ http://127.0.0.1:8001/chats/
    ProxyPassReverse /chats/ http://127.0.0.1:8001/chats/
    
    ProxyPass /settings/ http://127.0.0.1:8001/settings/
    ProxyPassReverse /settings/ http://127.0.0.1:8001/settings/
    
    ProxyPass /perfil/ http://127.0.0.1:8001/perfil/
    ProxyPassReverse /perfil/ http://127.0.0.1:8001/perfil/
    
    ProxyPass /notifications/ http://127.0.0.1:8001/notifications/
    ProxyPassReverse /notifications/ http://127.0.0.1:8001/notifications/
    
    # Proxy all other requests except static and media files
    ProxyPass /static/ !
    ProxyPass /media/ !
    ProxyPass / http://127.0.0.1:8001/
    ProxyPassReverse / http://127.0.0.1:8001/
    
    # Static files
    Alias /static /app/funATI/staticfiles
    <Directory /app/funATI/staticfiles>
        Require all granted
        Options -Indexes
        AllowOverride None
        
        # Force proper MIME types
        <FilesMatch "\.(css)$">
            ForceType text/css
        </FilesMatch>
        <FilesMatch "\.(js)$">
            ForceType application/javascript
        </FilesMatch>
        <FilesMatch "\.(png)$">
            ForceType image/png
        </FilesMatch>
        <FilesMatch "\.(jpg|jpeg)$">
            ForceType image/jpeg
        </FilesMatch>
        <FilesMatch "\.(gif)$">
            ForceType image/gif
        </FilesMatch>
        <FilesMatch "\.(svg)$">
            ForceType image/svg+xml
        </FilesMatch>
        
        # Cache static files
        ExpiresActive On
        ExpiresByType text/css "access plus 1 month"
        ExpiresByType application/javascript "access plus 1 month"
        ExpiresByType image/png "access plus 1 month"
        ExpiresByType image/jpeg "access plus 1 month"
        ExpiresByType image/gif "access plus 1 month"
        ExpiresByType image/svg+xml "access plus 1 month"
    </Directory>
    
    # Media files
    Alias /media /app/funATI/media
    <Directory /app/funATI/media>
        Require all granted
    </Directory>
    
    # Security headers
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
    
    # Logging
    ErrorLog ${APACHE_LOG_DIR}/funati_error.log
    CustomLog ${APACHE_LOG_DIR}/funati_access.log combined
    
    # Increase timeout for long requests
    Timeout 300
    
</VirtualHost> 